@model ass2_BookReader.Models.PagedResult<ass2_BookReader.Models.Book>
@{
    ViewBag.Title = "Book List - Search, Sort and Pagination";
}

<section class="books-page">
    <h1>List of Books</h1>

    <!-- Search Area -->
    <div class="search-container">
        <form id="searchForm" action="@Url.Action("Index", "Books")" method="get">
            <input type="text"
                   name="searchTerm"
                   id="searchTerm"
                   placeholder="Search for the book title, author or category..."
                   value="@ViewBag.SearchTerm" />
            <button type="submit" class="search-btn">Search</button>
        </form>
    </div>

    <!-- Sort Area -->
    <div class="sort-container">
        <label for="sortBy">Sort by：</label>
        <select id="sortBy" name="sortBy" onchange="this.form.submit()">
            <option value="title_asc" @(ViewBag.SortBy == "title_asc" ? "selected" : "")>Title (A-Z)</option>
            <option value="title_desc" @(ViewBag.SortBy == "title_desc" ? "selected" : "")>Title (Z-A)</option>
            <option value="price_asc" @(ViewBag.SortBy == "price_asc" ? "selected" : "")>Price (Low to High)</option>
            <option value="price_desc" @(ViewBag.SortBy == "price_desc" ? "selected" : "")>Price (High to Low)</option>
            <option value="year_desc" @(ViewBag.SortBy == "year_desc" ? "selected" : "")>Publication Year (Newest First)</option>
        </select>
    </div>

    @if (Model.Items.Any())
    {
        <div class="books-grid">
            @foreach (var book in Model.Items)
            {
                <div class="book-card">
                    <div class="book-cover">
                        @if (!string.IsNullOrEmpty(book.CoverImage))
                        {
                            <img src="~/Images/@book.CoverImage" alt="@book.Title" loading="lazy">
                        }
                        else
                        {
                            <img src="https://via.placeholder.com/250x350?text=No+Cover" alt="No Cover" loading="lazy">
                        }
                    </div>
                    <div class="book-info">
                        <h3 class="book-title">
                            <a href="@Url.Action("Detail", "Books", new { id = book.Id })">@book.Title</a>
                        </h3>
                        <p class="book-author">Author: @book.Author</p>
                        <p class="book-category">Category: @book.Category</p>
                        <p class="book-price">¥@book.Price.ToString("F2")</p>
                        <p class="book-year">Publication Year: @book.PublishYear</p>
                        <div class="book-actions">
                            <a href="@Url.Action("Detail", "Books", new { id = book.Id })" class="btn detail-btn">View Details</a>
                            <a href="@Url.Action("Read", "Books", new { id = book.Id })" class="btn read-btn">Start Reading</a>
                        </div>
                    </div>
                </div>
            }
        </div>

        <div class="pagination-container">
            <ul class="pagination">
                @if (Model.CurrentPage > 1)
                {
                    <li>
                        <a href="@Url.Action("Index", "Books", new {
                            page = Model.CurrentPage - 1,
                            searchTerm = ViewBag.SearchTerm,
                            sortBy = ViewBag.SortBy
                        })" class="page-link">Previous</a>
                    </li>
                }
                else
                {
                    <li class="page-item disabled"><span class="page-link">Previous</span></li>
                }

                @for (int i = 1; i <= Model.TotalPages; i++)
                {
                    <li class="@(i == Model.CurrentPage ? "active" : "")">
                        <a href="@Url.Action("Index", "Books", new {
                            page = i,
                            searchTerm = ViewBag.SearchTerm,
                            sortBy = ViewBag.SortBy
                        })" class="page-link">@i</a>
                    </li>
                }

                @if (Model.CurrentPage < Model.TotalPages)
                {
                    <li>
                        <a href="@Url.Action("Index", "Books", new {
                            page = Model.CurrentPage + 1,
                            searchTerm = ViewBag.SearchTerm,
                            sortBy = ViewBag.SortBy
                        })" class="page-link">Next</a>
                    </li>
                }
                else
                {
                    <li class="page-item disabled"><span class="page-link">Next</span></li>
                }
            </ul>
            <p class="pagination-info">
                Total @Model.TotalItems books, Page @Model.CurrentPage of @Model.TotalPages
            </p>
        </div>
    }
    else
    {
        <div class="no-results">
            <p>No books found matching your criteria. Please try a different search term or sort option.</p>
        </div>
    }
</section>